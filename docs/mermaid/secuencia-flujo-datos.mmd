%%{init: {'theme':'default'}}%%
graph TD
    subgraph Fase1["Fase 1: Recepción"]
        C1[Cliente envía datos] --> V1[API valida estructura]
        V1 --> P1[Prepara transacciones]
    end
    
    subgraph Fase2["Fase 2: Blockchain"]
        P1 --> B1[Transacción Light<br/>hash a lightchannel]
        P1 --> B2[Transacción Heavy<br/>JSON a heavychannel]
        B1 --> E1[Endorsement]
        B2 --> E2[Endorsement]
        E1 --> L1[Commit al Ledger]
        E2 --> L2[Commit al Ledger]
    end
    
    subgraph Fase3["Fase 3: Persistencia"]
        L1 --> D1[Guardar en light_model_data]
        L2 --> D2[Guardar en heavy_model_data]
        D1 --> M1[Metadatos + JSON]
        D2 --> M2[Solo metadatos]
    end
    
    subgraph Fase4["Fase 4: Respuesta"]
        M1 --> R1[Generar respuesta]
        M2 --> R1
        R1 --> R2[Enviar txIDs al cliente]
    end
    
    style Fase1 fill:#e1f5ff
    style Fase2 fill:#f0e1ff
    style Fase3 fill:#e1ffe1
    style Fase4 fill:#ffe1e1
    style B1 fill:#FFD700
    style B2 fill:#FFA500
    style D1 fill:#87CEEB
    style D2 fill:#DDA0DD